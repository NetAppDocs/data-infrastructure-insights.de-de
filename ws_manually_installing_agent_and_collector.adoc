---
sidebar: sidebar 
permalink: ws_manually_installing_agent_and_collector.html 
keywords: install, configure, agent, collector, workload, security, cloud secure 
summary: Workload Security-Agenten können manuell installiert oder aktualisiert werden, wodurch Sie mehr Kontrolle über die auf Ihrem Mandanten installierte Software haben. 
---
= Manuelles Installieren von Workload Security Agent und Collector
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Wenn eine neue Version eines Workload Security-Agenten oder -Collectors verfügbar ist, wird standardmäßig eine Benachrichtigung vor dem Upgrade gesendet und Agenten und Collector werden auf Ihrem Mandanten automatisch aktualisiert.  In einer sicheren, kontrollierten Umgebung sind automatische Upgrades jedoch möglicherweise nicht erwünscht.  In solchen Fällen kann Workload Security für die manuelle Installation/Aktualisierung von Agenten und Collectoren konfiguriert werden, wodurch Sie mehr Kontrolle über die auf Ihren Systemen installierte Software haben.



== Bevor Sie beginnen

. Überprüfen Sie in Swagger, ob die API-Kategorien mit den Namen „cloudsecure_installers.agent“ und „cloudsecure_installers.collector“ verfügbar sind.  Wenn nicht, ist die Unterstützung für die manuelle Agenteninstallation nicht aktiviert.  Wenden Sie sich bitte an den NetApp Support, um die Funktion zu aktivieren.
+
image:ws_manual_install_APIs.png["Manuelle Installations-APIs"]

. Führen Sie alle in diesem Dokument genannten Befehle als „Root“-Benutzer aus. Wenn Sie die Ausführung mit einem anderen Benutzer durchführen, führen Sie die Befehle mit „sudo“ aus.




== Installieren eines neuen Agenten

. Erstellen Sie ein neues Workload Security API-Zugriffstoken.
+
.. Navigieren Sie zu *Admin > API-Zugriff*.  Wählen Sie die Registerkarte „Workload Security Tokens“ und klicken Sie auf „+ API Access Token“.
+
... Legen Sie einen Namen und eine Beschreibung fest, die leicht zu identifizieren sind.
... Wählen Sie im Dropdown-Menü „Welche Art von APIs werden mit diesem Token aufgerufen?“ die Optionen „Collector-Verwaltung“ und „Agent- und Collector-Installation“ aus.
... Wählen Sie die gewünschte Ablaufdauer aus.


.. Klicken Sie auf _Speichern_.




[[copy-access-token]]
. Kopieren Sie das generierte API-Zugriffstoken.  Bitte beachten Sie, dass der Token nach dem Schließen des Fensters nicht mehr abgerufen werden kann.  In diesem Fall müssten Sie ein neues Token generieren.
+
image:ws_create_and_save_token.png["API-Token erstellen und speichern"]

+
image:ws_create_and_save_token_confirm.png["Bestätigen Sie die Token-Erstellung"]

+
.. Navigieren Sie zu *Admin > API-Zugriff > API-Dokumentation* (oben rechts auf der Seite) und wählen Sie das Symbol _Workload-Sicherheit_ aus.  Dadurch wird die Swagger-Dokumentation für Workload Security-APIs geöffnet.
+
image:ws_swagger_documentation_link.png["Swagger-Dokumentation für Workload Security"]

.. Autorisieren Sie den Zugriff auf _Workload Security_-APIs.


. Klicken Sie oben rechts auf der Seite auf die Schaltfläche _Autorisieren_.
. Fügen Sie im Textfeld _Customer ApiKey (apiKey)_ das zuvor kopierte API-Token ein von<<copy-access-token,Schritt 1c>> .
. Klicken Sie auf _Autorisieren_ und schließen Sie das Fenster.
+
image:ws_API_authorization.png["Autorisieren der API"]

+
.. Laden Sie das Agent-Installationsprogramm herunter.


. Wählen Sie in Swagger _cloudsecure_installers.agent_ > _/v1/cloudsecure/agents/installers/{platform}/latest_ (GET) API aus.  Klicken Sie auf _Ausprobieren_.
. Geben Sie im Feld _Plattform_ _Linux_ ein.  Klicken Sie auf _Ausführen_.
+
image:ws_installers_agent_api_swagger.png["Swagger für Agent-Installer-API – oben"] image:ws_installers_agent_api_swagger-2.png["Swagger für Agent-Installer-API – Antwort"]

. Klicken Sie auf „Datei herunterladen“, um das Installationsprogramm herunterzuladen.
. Wenn die Installationsdatei extern auf einen anderen Computer als das System heruntergeladen wird, auf dem der Agent installiert werden soll, kopieren Sie die Installationsdatei auf dieses System.
. Alternativ können Sie den Curl-Befehl kopieren und direkt in dem System ausführen, in dem der Agent installiert werden soll.
+
** Fügen Sie dem Curl-Befehl das Argument „-o {{file_name}}“ hinzu, um die Installationsdatei unter dem gewünschten Namen zu speichern.  Den tatsächlichen Namen der Installationsdatei finden Sie im Abschnitt „Swagger-Antwortheader“.  Dieser Name kann auch verwendet werden.
+
image:ws_installers_agent_api_swagger_installer_file.png["Auswahl des neuesten Agenten über die API – Swagger"]

** Obwohl die Datei an einen beliebigen Ort heruntergeladen werden kann, wird empfohlen, sie in einen leeren Ordner herunterzuladen, in dem die ZIP-Datei des Installationsprogramms extrahiert werden kann.
+
... Erstellen Sie einen neuen Ordner (empfohlen), kopieren Sie die Installationsdatei in diesen Ordner und entpacken Sie sie:
+
[listing]
----
[root@demo-agent /]# mkdir agent_installers
[root@demo-agent /]# cd agent_installers/
[root@demo-agent agent_installers]# pwd
/agent_installers
[root@demo-agent agent_installers]# ll
total 0
[root@demo-agent agent_installers]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/agents/installers/linux/latest" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cloudsecure-linux-agent-installer-1.617.0.zip
[root@demo-agent agent_installers]# ll
total 76012
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip
----
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.617.0.zip
Archive:  cloudsecure-linux-agent-installer-1.617.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
----
... Legen Sie die Ausführungsberechtigung für die Datei „cloudsecure-agent-install.sh“ fest.
+
[listing]
----
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-install.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154250 Apr 26 06:37 cloudsecure-agent-image.zip
-rwx------ 1 root root    16574 Apr 26 06:25 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26 06:25 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip

----
... Generieren Sie ein einmaliges Token für die Installation eines neuen Agenten.
+
Hinweis: Das in diesem Schritt generierte Einmaltoken unterscheidet sich vom API-Zugriffstoken, das bei<<copy-access-token,Schritt 1c>> .





. Führen Sie in Swagger _cloudsecure_installers.agent > /v1/cloudsecure/agent/oneTimeToken_ API aus und kopieren Sie das Token aus der Antwort.
+
.. Exportieren Sie das Einmaltoken als Umgebungsvariable.
+
[listing]
----
[root@demo-agent ~]# export TOKEN=<<one time token generated in step 7>>
----
.. Wenn ein Proxyserver verwendet wird, exportieren Sie https_proxy als Umgebungsvariable im unten genannten Format.
+
[listing]
----
[root@demo-agent ~]# export HTTPS_PROXY='USER:PASSWORD@PROXY_SERVER:PORT'
----
.. Optional: Standardmäßig werden Agent und Collector im Pfad „/opt/netapp“ installiert.  Um die Installation in einem anderen Pfad durchzuführen, legen Sie die folgende Umgebungsvariable fest:
+
[listing]
----
[root@demo-agent ~]# export AGENT_INSTALL_PATH=/test_user/apps
----
+
Hinweis: Bei der Installation in einem benutzerdefinierten Pfad werden Datensammler und alle anderen Artefakte wie Agentenprotokolle nur innerhalb des benutzerdefinierten Pfads erstellt.  Installationsprotokolle sind weiterhin in - _/var/log/netapp/cloudsecure/install_ vorhanden.

.. Gehen Sie zurück in das Verzeichnis, in das das Agent-Installationsprogramm heruntergeladen wurde, und führen Sie „cloudsecure-agent-install.sh“ aus.
+
[listing]
----
[root@demo-agent agent_installers]# ./ cloudsecure-agent-install.sh
----
+
Hinweis: Wenn der Benutzer keine „Bash“-Shell ausführt, funktioniert der Exportbefehl möglicherweise nicht.  In diesem Fall können die Schritte 8 bis 11 kombiniert und wie unten beschrieben ausgeführt werden.  HTTPS_PROXY und AGENT_INSTALL_PATH sind optional und können ignoriert werden, wenn sie nicht benötigt werden.

+
[listing]
----
sudo /bin/bash -c "TOKEN=<<one time token generated in step 7>> HTTPS_PROXY=<<proxy details in the format mentioned in step 9>> AGENT_INSTALL_PATH=<<custom_path_to_install_agent>> ./cloudsecure-agent-install.sh"
----
+
An diesem Punkt sollte der Agent erfolgreich installiert sein.

.. Plausibilitätsprüfung für die Agenteninstallation:


. Führen Sie „systemctl status cloudsecure-agent.service“ aus und überprüfen Sie, ob der Agentendienst im Status „running“ ist.
+
[listing]
----
[root@demo-agent ~]# systemctl status cloudsecure-agent.service
 cloudsecure-agent.service - Cloud Secure Agent Daemon Service
   Loaded: loaded (/usr/lib/systemd/system/cloudsecure-agent.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2024-04-26 02:50:37 EDT; 12h ago
 Main PID: 15887 (java)
    Tasks: 72
   CGroup: /system.slice/cloudsecure-agent.service
           ├─15887 java -Dconfig.file=/test_user/apps/cloudsecure/agent/conf/application.conf -Dagent.proxy.host= -Dagent.proxy.port= -Dagent.proxy.user= -Dagent.proxy.password= -Dagent.env=prod -Dagent.base.path=/test_user/apps/cloudsecure/agent -...

----
. Der Agent sollte auf der Seite „Agenten“ sichtbar sein und sich im Status „Verbunden“ befinden.
+
image:ws_agentsPageShowingConnected.png["Benutzeroberfläche mit Anzeige verbundener Agenten"]

+
.. Bereinigung nach der Installation.


. Wenn die Agenteninstallation erfolgreich war, können die heruntergeladenen Agenteninstallationsdateien gelöscht werden.




== Installieren eines neuen Datensammlers.

Hinweis: Dieses Dokument enthält Anweisungen zur Installation des „ONTAP SVM-Datenkollektors“.  Dieselben Schritte gelten für „Cloud Volumes ONTAP Datensammler“ und „Amazon FSx for NetApp ONTAP Datensammler“.

. Gehen Sie zu dem System, auf dem der Collector installiert werden soll, und erstellen Sie ein Verzeichnis mit dem Namen _./tmp/collectors_ unter dem Verzeichnis _Agent-Installationspfad_.
+
Hinweis: Wenn der Agent in _/opt/netapp_ installiert ist, navigieren Sie zu _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. Ändern Sie den Besitz des Verzeichnisses _tmp_ rekursiv in *cssys:cssys* (der Benutzer und die Gruppe cssys werden während der Agenteninstallation erstellt).
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. Jetzt müssen wir die Collector-Version und die UUID des Collectors abrufen.  Navigieren Sie zur API „cloudsecure_config.collector-types“.
. Gehen Sie zu Swagger, „cloudsecure_config.collector-types > /v1/cloudsecure/collector-types“ (GET) API.  Wählen Sie im Dropdown-Menü „collectorCategory“ als Sammlertyp „DATA“ aus.  Wählen Sie „ALLE“, um alle Details zum Sammlertyp abzurufen.
. Kopieren Sie die UUID des erforderlichen Collector-Typs.
+
image:ws_collectorAPIShowingUUID.png["Collector-API-Antwort mit UUID"]

. Laden Sie das Collector-Installationsprogramm herunter.
+
.. Navigieren Sie zur API „cloudsecure_installers.collector > /v1/cloudsecure/collector-types/installers/{collectorTypeUUID}“ (GET).  Geben Sie die im vorherigen Schritt kopierte UUID ein und laden Sie die Installationsdatei herunter.
+
image:ws_downloadCollectorByUUID.png["API zum Herunterladen des Collectors per UUID"]

.. Wenn die Installationsdatei extern auf einen anderen Computer heruntergeladen wird, kopieren Sie die Installationsdatei auf das System, auf dem der Agent ausgeführt wird, und platzieren Sie sie im Verzeichnis _/{agent-install-path}/cloudsecure/tmp/collectors_.
.. Alternativ können Sie den Curl-Befehl aus derselben API kopieren und direkt auf dem System ausführen, auf dem der Collector installiert werden soll.
+
Beachten Sie, dass der Dateiname mit dem in den Antwortheadern der Download-Collector-API identisch sein sollte. Siehe Screenshot unten.

+
Hinweis: Wenn der Agent in _/opt/netapp_ installiert ist, navigieren Sie zu _/opt/netapp/cloudsecure/tmp/collectors_.

+
image:ws_curl_command.png["Beispiel eines Curl-Befehls mit verschleiertem Token"]

+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/1829df8a-c16d-45b1-b72a-ed5707129870" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ontap-dsc_1.286.0.zip
----


. Ändern Sie den Besitz der ZIP-Datei des Collector-Installationsprogramms in *cssys:cssys*.
+
[listing]
----
-rw------- 1 root root 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# ll
total 49716
-rw------- 1 cssys cssys 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
----
. Navigieren Sie zu *Workload Security > Collectors* und wählen Sie *+Collector* aus.  Wählen Sie den _ONTAP SVM_-Collector.
. Konfigurieren Sie die Collectordetails und _Speichern_ Sie den Collector.
. Wenn Sie auf _Speichern_ klicken, sucht der Agentenprozess das Collector-Installationsprogramm im Verzeichnis _/{agent-install-path}/cloudsecure/tmp/collectors/_ und installiert den Collector.
. Alternativ kann der Collector auch über die API hinzugefügt werden, anstatt ihn über die Benutzeroberfläche hinzuzufügen.
+
.. Navigieren Sie zu „cloudsecure_config.collectors“ > „/v1/cloudsecure/collectors“ (POST) API.
.. Wählen Sie im Beispiel-Dropdown-Menü „ONTAP SVM-Datensammler-JSON-Beispiel“ aus, aktualisieren Sie die Konfigurationsdetails des Sammlers und führen Sie aus.
+
image:ws_API_add_collector.png["API zum Hinzufügen eines Collectors"]



. Der Collector sollte jetzt im Abschnitt „Datensammler“ sichtbar sein.
+
image:ws_collectorPageList.png["UI-Listenseite mit Sammlern"]

. Bereinigung nach der Installation.
+
.. Wenn die Collector-Installation erfolgreich ist, können alle Dateien im Verzeichnis _/{agent-install-path}/cloudsecure/tmp/collectors_ gelöscht werden.






== Installieren eines neuen User Directory Collector

Hinweis: In diesem Dokument haben wir die Schritte zum Installieren eines LDAP-Collectors beschrieben.  Für die Installation eines AD-Collectors gelten die gleichen Schritte.

. 1. Gehen Sie zu dem System, auf dem der Collector installiert werden soll, und erstellen Sie ein Verzeichnis mit dem Namen _./tmp/collectors_ unter dem Verzeichnis _Agent-Installationspfad_.
+
Hinweis: Wenn der Agent in _/opt/netapp_ installiert ist, navigieren Sie zu _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
+
.. Ändern Sie den Besitz des Verzeichnisses _collectors_ in *cssys:cssys*
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp

[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors

----


. Jetzt müssen wir die Version und UUID des Collectors abrufen.  Navigieren Sie zur API „cloudsecure_config.collector-types“.  Wählen Sie im Dropdown-Menü „collectorCategory“ den Collector-Typ „USER“ aus.  Wählen Sie „ALLE“, um alle Collector-Typdetails in einer einzigen Anfrage abzurufen.
+
image:ws_API_collector_all.png["API zum Abrufen aller Sammler"]

. Kopieren Sie die UUID des LDAP-Collectors.
+
image:ws_LDAP_collector_UUID.png["API-Antwort mit der LDAP-Collector-UUID"]

. Laden Sie das Collector-Installationsprogramm herunter.
+
.. Navigieren Sie zu „cloudsecure_installers.collector“ > „/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}“ (GET) API.  Geben Sie die im vorherigen Schritt kopierte UUID ein und laden Sie die Installationsdatei herunter.
+
image:ws_LDAP_collector_UUID_download.png["API und Antwort zum Download-Collector"]

.. Wenn die Installationsdatei extern auf einen anderen Computer heruntergeladen wird, kopieren Sie die Installationsdatei auf das System, auf dem der Agent ausgeführt wird, und in das Verzeichnis _/{Agent-Installationspfad}/cloudsecure/tmp/collectors_.
.. Alternativ können Sie den Curl-Befehl aus derselben API kopieren und direkt in dem System ausführen, in dem der Collector installiert werden soll.
+
Beachten Sie, dass der Dateiname mit dem in den Antwortheadern der Download-Collector-API identisch sein sollte. Siehe Screenshot unten.

+
Beachten Sie auch, dass Sie zu _/opt/netapp/cloudsecure/tmp/collectors_ navigieren müssen, wenn der Agent in _/opt/netapp_ installiert ist.

+
image:ws_curl_command.png["Curl-Befehls-API"]



+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/37fb37bd-6078-4c75-a64f-2b14cb1a1eb1" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ldap-dsc_1.322.0.zip
----
. Ändern Sie den Besitz der ZIP-Datei des Collector-Installationsprogramms in cssys:cssys.
+
[listing]
----
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 root root 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 cssys cssys 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip

----
. Navigieren Sie zur Seite „User Directory Collectors“ und klicken Sie auf „+ User Directory Collector“.
+
image:ws_user_directory_collector.png["Hinzufügen eines Benutzerverzeichnis-Collectors"]

. Wählen Sie „LDAP-Verzeichnisserver“.
+
image:ws_LDAP_user_select.png["UI-Fenster zum Auswählen eines LDAP-Benutzers"]

. Geben Sie die Details des LDAP-Verzeichnisservers ein und klicken Sie auf „Speichern“.
+
image:ws_LDAP_user_Details.png["Benutzeroberfläche mit LDAP-Benutzerdetails"]

. Wenn Sie auf _Speichern_ klicken, sucht der Agent-Dienst das Collector-Installationsprogramm im Verzeichnis _/{agent-install-path}/cloudsecure/tmp/collectors/_ und installiert den Collector.
. Alternativ kann der Collector auch über die API hinzugefügt werden, anstatt ihn über die Benutzeroberfläche hinzuzufügen.
+
.. Navigieren Sie zu „cloudsecure_config.collectors“ > „/v1/cloudsecure/collectors“ (POST) API.
.. Wählen Sie im Beispiel-Dropdown-Menü „LDAP Directory Server user collector json sample“ aus, aktualisieren Sie die Collector-Konfigurationsdetails und klicken Sie auf „Ausführen“.
+
image:ws_API_LDAP_Collector.png["API für LDAP-Collector"]



. Der Collector sollte jetzt im Abschnitt „User Directory Collectors“ sichtbar sein.
+
image:ws_LDAP_collector_list.png["LDAP-Sammlerliste in der Benutzeroberfläche"]

. Bereinigung nach der Installation.
+
.. Wenn die Collector-Installation erfolgreich ist, können alle Dateien im Verzeichnis _/{agent-install-path}/cloudsecure/tmp/collectors_ gelöscht werden.






== Upgrade eines Agenten

Wenn eine neue Version des Agenten/Sammlers verfügbar ist, wird eine E-Mail-Benachrichtigung gesendet.

. Laden Sie das neueste Agent-Installationsprogramm herunter.
+
.. Die Schritte zum Herunterladen des neuesten Installationsprogramms ähneln denen unter „Installieren eines neuen Agenten“.  Wählen Sie in Swagger „cloudsecure_installers.agent“ > „/v1/cloudsecure/agents/installers/{platform}/latest“-API, geben Sie als Plattform „Linux“ ein und laden Sie die ZIP-Datei des Installationsprogramms herunter.  Alternativ kann auch ein Curl-Befehl verwendet werden.  Entpacken Sie die Installationsdatei.


. Legen Sie die Ausführungsberechtigung für die Datei „cloudsecure-agent-upgrade.sh“ fest.
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.618.0.zip
Archive:  cloudsecure-linux-agent-installer-1.618.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rwx------ 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip

----
. Führen Sie das Skript „cloudsecure-agent-upgrade.sh“ aus.  Wenn das Skript erfolgreich ausgeführt wurde, wird in der Ausgabe die Meldung „Cloudsecure-Agent wurde erfolgreich aktualisiert.“ gedruckt.
. Führen Sie den folgenden Befehl aus: „systemctl daemon-reload“
+
[listing]
----
[root@demo-agent ~]# systemctl daemon-reload
----
. Starten Sie den Agentendienst neu.
+
[listing]
----
[root@demo-agent ~]# systemctl restart cloudsecure-agent.service
----
+
An diesem Punkt sollte das Upgrade des Agenten erfolgreich abgeschlossen sein.

. Plausibilitätsprüfung nach dem Agent-Upgrade.
+
.. Navigieren Sie zum Pfad, in dem der Agent installiert ist (z. B. „/opt/netapp/cloudsecure/“).  Der symbolische Link „Agent“ sollte auf die neue Version des Agenten verweisen.
+
[listing]
----
[root@demo-agent cloudsecure]# pwd
/opt/netapp/cloudsecure
[root@demo-agent cloudsecure]# ll
total 40
lrwxrwxrwx  1 cssys cssys  114 Apr 26 17:38 agent -> /test_user/apps/cloudsecure/cloudsecure-agent-1.618.0
drwxr-xr-x  4 cssys cssys 4096 Apr 25 10:45 agent-certs
drwx------  2 cssys cssys 4096 Apr 25 16:18 agent-logs
drwx------ 11 cssys cssys 4096 Apr 26 02:50 cloudsecure-agent-1.617.0
drwx------ 11 cssys cssys 4096 Apr 26 17:42 cloudsecure-agent-1.618.0
drwxr-xr-x  3 cssys cssys 4096 Apr 26 02:45 collector-image
drwx------  2 cssys cssys 4096 Apr 25 10:45 conf
drwx------  3 cssys cssys 4096 Apr 26 16:39 data-collectors
-rw-r--r--  1 root  root    66 Apr 25 10:45 sysctl.conf.bkp
drwx------  2 root  root  4096 Apr 26 17:38 tmp

----
.. Der Agent sollte auf der Seite „Agenten“ sichtbar sein und sich im Status „Verbunden“ befinden.
+
image:ws_agentsPageShowingConnected.png["Benutzeroberfläche mit Anzeige verbundener Agenten"]



. Bereinigung nach der Installation.
+
.. Wenn die Agenteninstallation erfolgreich war, können die heruntergeladenen Agenteninstallationsdateien gelöscht werden.






== Upgrade von Kollektoren

Hinweis: Die Upgrade-Schritte sind für alle Kollektortypen gleich.  In diesem Dokument demonstrieren wir das Upgrade des „ONTAP SVM“-Collectors.

. Gehen Sie zu dem System, in dem die Collector-Instanzen aktualisiert werden müssen, und erstellen Sie das Verzeichnis _./tmp/collectors_ unter dem Verzeichnis _Agent-Installationspfad_, falls es noch nicht vorhanden ist.
+
Hinweis: Wenn der Agent in _/opt/netapp_ installiert ist, navigieren Sie zum Verzeichnis _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. Stellen Sie sicher, dass das Verzeichnis „collectors“ _cssys:cssys_ gehört.
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. Navigieren Sie in Swagger zur GET-API „cloudsecure_config.collector-types“.  Wählen Sie im Dropdown-Menü „collectorCategory“ „DATA“ aus (wählen Sie „USER“ für den Benutzerverzeichnis-Collector oder „ALL“).
+
Kopieren Sie UUID und Version aus dem Antworttext.

+
image:ws_collector_uuid_and_version.png["API-Antwort mit hervorgehobener Collector-UUID und Version"]

. Laden Sie die neueste Collector-Installationsdatei herunter.
+
.. Navigieren Sie zu _cloudsecure_installers.collector_ > _/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}_ API.  Geben Sie _collectorTypeUUID_ ein, das Sie aus dem vorherigen Schritt kopiert haben.  Laden Sie das Installationsprogramm in das Verzeichnis _/{agent-install-path}/cloudsecure/tmp/collectors_ herunter.
.. Alternativ kann auch der Curl-Befehl derselben API verwendet werden.
+
image:ws_curl_command_only.png["Beispiel für den Curl-Befehl"]

+
Hinweis: Der Dateiname sollte mit dem in den Antwortheadern der Download-Collector-API vorhandenen Namen übereinstimmen.



. Ändern Sie den Besitz der ZIP-Datei des Collector-Installationsprogramms in cssys:cssys.
+
[listing]
----
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 root root 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 cssys cssys 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip

----
. Lösen Sie die Upgrade-Collector-API aus.
+
.. Navigieren Sie in Swagger zu „cloudsecure_installers.collector“ > „/v1/cloudsecure/collector-types/upgrade“ (PUT) API.
.. Wählen Sie im Dropdown-Menü „Beispiele“ die Option „ONTAP SVM Data Collector Upgrade JSON Sample“ aus, um die Beispielnutzlast zu füllen.
.. Ersetzen Sie die Version durch die Version, die Sie kopiert haben von<<copy-access-token,Schritt 3>> und klicken Sie auf „Ausführen“.
+
image:ws_svm_ontap_collector_upgrade_example_json.png["SVM-Upgrade-Beispiel in der Swagger-Benutzeroberfläche"]

+
Warten Sie einige Sekunden.  Sammler werden automatisch aktualisiert.



. Plausibilitätsprüfung.
+
Collector sollten in der Benutzeroberfläche im laufenden Zustand sein.

. Bereinigung nach dem Upgrade:
+
.. Wenn das Collector-Upgrade erfolgreich ist, können alle Dateien im Verzeichnis _/{agent-install-path}/cloudsecure/tmp/collectors_ gelöscht werden.




Wiederholen Sie die obigen Schritte auch zum Aktualisieren anderer Kollektortypen.



== Allgemeine Probleme und Lösungen.

. AGENT014 Fehler
+
Dieser Fehler tritt auf, wenn die Collector-Installationsdatei nicht im Verzeichnis _/{agent-install-path}/cloudsecure/tmp/collectors_ vorhanden ist oder nicht darauf zugegriffen werden kann.  Stellen Sie sicher, dass die Installationsdatei heruntergeladen wurde und die vollständige Verzeichnisstruktur von _collectors_ und der ZIP-Datei des Installationsprogramms Eigentum von cssys:cssys ist. Starten Sie dann den Agentendienst neu: _systemctl restart cloudsecure-agent.service_.

+
image:ws_agent014_error.png["UI-Bildschirm mit dem Hover-Tipp „Agent 014“"]

. Unberechtigter Fehler
+
[listing]
----
{
  "errorMessage": "Requested public API is not allowed to be accessed by input API access token.",
  "errorCode": "NOT_AUTHORIZED"
}

----
+
Dieser Fehler wird angezeigt, wenn ein API-Zugriffstoken generiert wird, ohne alle erforderlichen API-Kategorien auszuwählen.  Generieren Sie ein neues API-Zugriffstoken, indem Sie alle erforderlichen API-Kategorien auswählen.


